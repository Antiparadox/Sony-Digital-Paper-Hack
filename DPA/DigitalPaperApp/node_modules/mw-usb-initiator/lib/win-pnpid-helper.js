/**
 * Windows に USB接続された機器の PNP ID (Plug and Play ID) を取り扱う。
 */

'use strict';

const log_error = require('debug')('mw-usb-initiator:win-pnpid-helper:error');
const log_debug = require('debug')('mw-usb-initiator:win-pnpid-helper:debug');


class WinPnpIdHelper {

    /**
     * USB機器の PNP ID 文字列から VID, PID を取得する。
     * 
     * @param   {string} pnpId      - USB機器のPNP ID。
     * @return  {{vid:number, pid:number}}}  Vendor ID および Product ID。エラー時にはnull。
     */
    static extractUsbVidPid(pnpId) {
        if (typeof pnpId !== 'string') {
            log_error(new TypeError('[ERROR] pnpId !== string [' + typeof pnpId + ']'));
            return null;
        }

        const array = pnpId.match(/^USB\\VID_(\w{4})&PID_(\w{4})&/);
        if (array && array.length >= 3) {
            return {
                vid: parseInt(array[1], 16),
                pid: parseInt(array[2], 16),
            };
        }
        log_debug("Unsupported PNP ID: " + pnpId);
        return null;
    }
}

module.exports = WinPnpIdHelper;
