
process.env.DEBUG = '*:error';

const AutoMagicClient = require('../index.js');

process.env.MW_DEBUG_AUTO_MAGIC = true;

const appVersion = '1.0.00.0000';
const appLanguage = 'Japanese';


function getDownloadProgressRepeatedly() {
    setTimeout(() => {
        if (AutoMagicClient.isDownloading()) {
            const progress = AutoMagicClient.getDownloadProgress();
            const percent = progress.current * 100 / progress.total;
            console.log('progress: ' + percent + ' current: ' + progress.current + ' total: ' + progress.total);
            if (percent > 5) {
              AutoMagicClient.stopDownloading(function() {
                console.log('canceled');
              });
              return;
            }
            getDownloadProgressRepeatedly();
        }
    }, 1000);
}


AutoMagicClient.checkForAppUpdate(
  appVersion,
  appLanguage,
  function(error, updateInfo){
  if (error) {
    console.error(error);
    return;
  }

  console.log('New Version Found: ' + updateInfo.newVersion);

  AutoMagicClient.downloadAppUpdater(
    updateInfo.updater,
    './download',
    function(error) {
      if (error) {
        console.error('Download Failed: ', error);
        return;
      }

      console.log('Download Completed !');
  });

  getDownloadProgressRepeatedly();

});

