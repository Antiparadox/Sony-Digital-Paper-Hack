# node-mw-automagic-client

Auto Magic の配信管理サーバーにアクセスし、アプリやデバイスのアップデートの確認、アップデートファイルのダウンロードを行う node module です。

## 主な機能

- アプリ(Altair)のアップデートの確認
  - 実行中のアプリのバージョンとOSのバージョンを元にアップデートの有無を確認する
  - アップデートが見つかった場合には、アップデートの説明文/免責文/EULAをダウンロードする
    - アップデートの説明文の言語は、アプリの表示言語に合わせる
    - アップデートの免責文/EULAの言語は、OSのロケールの地域情報に合わせる
    - アップデートの説明文/免責文/EULAなどを表示する機能は提供しない

- アプリ(Altair)のアップデートファイルの取得
  - アップデートファイル（インストーラー）をダウンロードする
  - ダウンロード中の進捗取得および中断の機能を提供する
    - 進捗などを表示する機能は提供しない

- デバイス(Deneb)のアップデートの確認
  - デバイスのバージョンとモデル名を元にアップデートの有無を確認する
    - デバイスの情報取得など、デバイスへのアクセスは行わない
  - アップデートが見つかった場合には、アップデートの説明/免責/EULAをダウンロードする
    - アップデートの説明文の言語は、アプリの表示言語に合わせる
    - アップデートの免責文/EULAの言語は、デバイスの仕向け情報に合わせる

- デバイス(Deneb)のアップデートファイルの取得
  - アップデートファイルをダウンロードする
  - ダウンロード中の進捗取得および中断の機能を提供する
    - 進捗などを表示する機能は提供しない
    - デバイスへのアップデートファイルの転送など、デバイスへのアクセスは行わない

## インタフェース

* [interface.md](doc/interface.md)


# Auto Magic について

> “Auto Magic”は、ソニー製品のための共通のソフトウエア・アップデートシステムです。

詳細は、下記を確認してください。

- Auto Magic - 共通ダウンロードポータル
  - https://automagic.intersony.sony.co.jp/

- Auto Magic 配信管理システム
  - https://automagic.intersony.sony.co.jp/


# Deneb のアップデートについて

## Deneb のアップデートの処理手順

node-mw-automagic-client を使用して、Deneb をアップデートする際の処理手順は以下の通りです。

1. Auto Magic の配信サーバーから「アップデート情報ファイル」をダウンロードする
2. 「アップデート情報ファイル」の解析および検証を行う
3. Denebから取得した情報と「アップデート情報ファイル」の情報を比較してアップデートの有無を確認する
4. Auto Magic の配信サーバーから「免責ファイル」「EULAファイル」をダウンロードする
5. ユーザーに免責事項およびEULAへの同意を求める
6. Auto Magic の配信サーバーから「アップデートファイル」をダウンロードする
7. 「アップデートファイル」の検証を行う
8. Denebに「アップデートファイル」を転送する
9. Denebにコマンドを発行して、アップデートを開始する

## Deneb のアップデート用の Auto Magic の登録情報

- Category ID / Category Name
  - DR001 / Reader
- Service ID / Service Name
  - DPTRP1 / DPT-RP1_Firmware

## Deneb のアップデート適用条件

- Denebから取得した「バージョン」が「アップデート情報ファイル」で指定された「FirmwareVersion」の値未満「LessThan」であること
- Denebから取得した「モデル名」が「アップデート情報ファイル」で指定された「Model」の値と同一「Equal」であること

例）"DPT-RP1"を"1.1.00.11289"にアップデートする場合
```xml
  <Rules> 
    <Rule Type="System" Key="FirmwareVersion" Value="1.1.00.11289" Operator="LessThan" /> 
    <Rule Type="System" Key="Model" Value="DPT-RP1" Operator="Equal" /> 
  </Rules> 
```

## Deneb のアップデート時の免責/EULAの表示言語

- Denebから取得した仕向け情報（SKUコード)に合わせる
  - SKUコード: J (Japan仕向け)
    - Japanese の文言を表示
  - SKUコード: U (U.S.仕向け)
    - English の文言を表示
  - その他
    - 「アップデート情報ファイル」内のデフォルト設定に合わせる



# Altair のアップデートについて

## Altair のアップデートの処理手順

node-mw-automagic-client を使用して、Altair をアップデートする際の処理手順は以下の通りです。

1. Auto Magic の配信サーバーから「アップデート情報ファイル」をダウンロードする
2. 「アップデート情報ファイル」を解析および検証を行う
3. 実行中のアプリの情報と「アップデート情報ファイル」の情報を比較してアップデートの有無を確認する
4. Auto Magic の配信サーバーから「免責ファイル」「EULAファイル」をダウンロードする
5. ユーザーに免責事項およびEULAへの同意を求める
6. Auto Magic の配信サーバーから「アップデートファイル（インストーラー）」をダウンロードする
7. 「アップデートファイル（インストーラー）」の検証を行う
8. インストーラーを起動して、アップデートインストールを行う


## Altair のアップデート用の Auto Magic の登録情報

- Category ID / Category Name
  - DR001 / Reader
- Service ID / Service Name
  - DigitalPaperApp_W / DigitalPaperApp_for_Win
  - DigitalPaperApp_M / DigitalPaperApp_for_Mac

## Altair のアップデート適用条件

- Altairの「バージョン」が「アップデート情報ファイル」で指定された「FirmwareVersion」の値未満「LessThan」であること
- Windows/OS X の「バージョン」が「アップデート情報ファイル」で指定された「OSVersion」の値以上「GreaterThanEqual」であること

例）Windows 7 (6.1) 以上の環境で"99.1.0.11141"へアップデートする場合
```xml
    <Rules> 
      <Rule Type="System" Key="FirmwareVersion" Value="99.1.0.11141" Operator="LessThan" /> 
      <Rule Type="System" Key="OSVersion" Value="6.1" Operator="GreaterThanEqual" /> 
    </Rules>
```

例）OS X 10.10 以上の環境で"99.1.0.11141"へアップデートする場合
```xml
    <Rules> 
      <Rule Type="System" Key="FirmwareVersion" Value="99.1.0.11141" Operator="LessThan" /> 
      <Rule Type="System" Key="OSVersion" Value="10.10" Operator="GreaterThanEqual" /> 
    </Rules> 
```

## Altair のアップデート時の免責/EULAの表示言語

- Windows/OS X から取得したロケールの地域情報に合わせる
  - JP (日本)
    - Japanese の文言を表示
  - US (U.S.)
    - English の文言を表示
  - その他
    - 「アップデート情報ファイル」内のデフォルト設定に合わせる





