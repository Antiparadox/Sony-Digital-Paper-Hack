MilkyWay Registration Control (mw-reg-ctrl)
====================

登録処理を実現するModule

Module Functions
--------------------

* デバイス登録可能なデバイスを列挙し、デバイス登録シーケンスを流す
  - 呼び出しもとに対して、PIN入力を促す。
  - 登録シーケンス上に何らかのエラーが発生したら登録シーケンスを中止して、呼び出し元に通知。

Module API
--------------------

* [interface](doc/interface.md)

Module Assumption
--------------------

* このモジュールを、Electronから利用する場合には、Main Processで利用する事とする。

  実際のGUIは、Renderer Processで実行することが想定されるが、その場合
  には、electron.remote.require()を利用して、Main Process上でロードする。

  例:
  ```
  const electron = require('electron');
  const regctrl = electron.remote.require('mw-reg-ctrl');
  ```

* モジュールを呼び出す時には、内部的に万一にでも、HTTP PROXY経由で通信
  をしてしまわないようにするため、`process.env.NO_PROXY = '*'`に設定する。

  プロセス全体に効いてしまう設定のため、モジュール内では設定していない。

Module Main Dependencies
--------------------

* [dependencies](doc/dependencies.md)

開発する上での情報(参考情報)
====================

Moduleを単独で動作させる大まかな手順
--------------------

最初に、Private Keyと、Public Keyのセットを作る。mw-auth-storeがStubの
ため。
```
$ ./scripts/generatekeys.sh
```

```
$ npm init . # テストレポの作成
$ npm install git+ssh://git@scm.sm.sony.co.jp:milkyway/node-mw-reg-ctrl.git # reg-ctrl のセットアップ
$ node 
```

```
> .load node_modules/mw-reg-ctrl/test/stubs.js
> var regctrl = require('mw-reg-ctrl');
> regctrl.setOnPinRequest(pinRequestByPrompt);
> regctrl.setOnBeforeStoreCert(beforeStoreCertPrompt);
> regctrl.registerDevice('HOGEHOUGE', checkCallback);
```


Moduleそのものを開発する際の大まかな手順
--------------------

1. package.jsonに記述している、git+ssh で記載しているRepoを、この
   ModuleのRepoと同じ階層にCloneする。

   - node-auth-adpt-mw
   - node-mw-auth-ctrl
   - node-mw-discovery-ctrl
   - node-mw-error
   - node-mw-port-fwdr
   - node-mw-reg-ctrl
   - node-reg-store-mw

2. npm link を行う

```
$ ./scripts/generatekeys.sh
```



