/**
    testclient.js
    
    creator:    kan.k
    created:    [2016-05-24 20:07:45+09:00]
    modified:   [2016-05-24 20:07:45+09:00]
    description:
    Test client
    
*/

const request = require('request');

// ///////////////////////////////////
// /// Prepare Big Buffer
// ///////////////////////////////////


// const fs = require('fs');

// var content = '0123456789';

// var data = '';

// for ( var i = 0; i < 100 * 1000; i ++ ) {
//   data += content;
// }

// var dataBuf = Buffer.from(data);

///////////////////////////////////
///	Get it
///////////////////////////////////

var baseUrl = 'http://127.0.0.1:3000';
// var baseUrl = 'http://127.0.0.1:58080';

exports.getTestFile = function(port) {
  var baseUrl = 'http://127.0.0.1:' + port.toString();
  return new Promise(function(resolve, reject) {
	var starttime = process.uptime();
	request.get(baseUrl + '/api/getfile', function( err, res, body ) {
      console.log(body.length);
      console.log('Elapsed: ', process.uptime() - starttime);
	  resolve(body.length);
	});
  });
};

///////////////////////////////////
/// Post it
///////////////////////////////////


exports.postTestFile = function (port) {
  var starttime = process.uptime();
  var req = request.post(baseUrl + '/api/file', function (err, res, body) {
    if ( err ) {
      console.error('Error: ', err);
    } else {
      console.log('Status: ', res.statusCode);
    }
    console.log('Elapsed: ', process.uptime() - starttime);
  });

  var form = req.form();
  form.append('file', dataBuf, { filename: 'SOMEFILE.txt', contentType: 'jpeg' });
};

