mw-error
====================

MilkyWay内で共通で利用するエラー定義とエラーコード。

Module Policy
--------------------

このModuleで扱うのは、Operational Error(正しく記述されたプログラムで、
実行時に起きる問題やエラーケース)のみ。

それ以外の、Programmer errors(プログラム上のバグに起因する問題やエラー
ケース)は、このモジュールでエラーコードを定義しない。

エラーハンドラ側は、mwCodeのプロパティの値で、Operational Errorの処理
を決定する事を想定している。

Module API
--------------------

* [Interface](doc/interface.md)


MilkyWay Error Handling Policy
==============================

Errorの種類の共通認識
---------------------

### Operational Error

* Operational Error(正しく記述されたプログラムで、実行時に起きる問題や
  エラーケース)に関しては、返す方法(throwするか、callbackで返すか等)は
  必ず統一する。
  
  例)
  - callbackで処理を返す関数なら、Errorもcallbackで返すのみにする。
  - Promiseオブジェクトを返す関数なら、Promiseオブジェクトを必ず返して
    Error時は、Promiseをrejectする方法のみ。
  - Errorをthrowする関数なら、Errorは必ずthrowする。(非推奨)


* Error ObjectのmwCodeにMilkyWayで定義したError Codeを必ず設定する。
  - このモジュールで定義している、genError()か、genWebApiError()を使う
    事を推奨する。

  例)
  ```
  const mwe = require('mw-error');
  ```

  ```
  if ( abortFlag ) {
    callback(mwe.genError(mwe.E_MW_ABORTED, 'The process aborted'));
    return;
  }
  ```
  
  ```
  if ( res.statusCode !== 200 ) {
    callback(mwe.genWebApiError(mwe.E_MW_WEBAPI_UNEXPECTED_STATUS, 'The status is wrong.',
    				'GET', '/some/apiname', res.statusCode, res.body));
    return;
  }
  ```

  ```
  return new Promise(function(resolve, reject) {
    fs.readFile('SOMEFILE', function(err) {
      if ( err ) {
        reject(err);
      }
      ...
    }
  }
  ```

### Programmer Error

* Programmer Error(プログラム上のバグに起因する問題やエラー)に関しては、
  発生し次第直ぐに、throwする。

  例)
  - 値のTypeが想定外の場合、 ->
  ```
  if ( typeof someArg !== 'string' ) {
    throw new TypeError('someArg must be a string.');
  }
  ```

  - 引数の添え字の指定が想定外の場合 ->
  ```
  if ( num > MAXNUMBER ) {
    throw new RangeError('num exceeds MAXNUMBER.');
  }
  ```

  - その他仕様上、存在し得ない状態、呼び出され方等
  ```
  if ( a > 10 && c === 3 ) {
    throw new Error('This is wrong call. Can not be.');
  }
  ```

### 参考情報

* https://www.joyent.com/node-js/production/design/errors


Operational Errorを発行する場合、ハンドルする場合の共通知識
----------------------------------------------------------

* Operational Errorを発行する場合、Errorをハンドルする場合には、Error
  オブジェクトの次のPropertyを利用する事。
  
  * [Error プロパティ一覧](doc/interface.md#module_mwe..MWError)

