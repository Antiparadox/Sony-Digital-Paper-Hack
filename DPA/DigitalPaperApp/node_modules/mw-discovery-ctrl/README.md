mw-discovery-ctrl
====================

USBおよびPCに接続されているその他のネットワークインターフェースで通信
可能なDenebのIPを特定、保持、列挙する。

Module Function
--------------------

* 呼び出しに応じて、現在取得できているDenebの一覧情報を返す。
  - Denebの情報は、DenebのHost名(mDNS.DNS-SDのInstance名), Device ID,
    IPv4 address, IPv6 address, mDNSから取得できたPort番号, 接続方式
    (USB or other NIC)とする。
  
* 通信可能なDenebが登場した場合、呼び出し元に通知する。
  - 例として、mDNSで、新たに、対応するServiceが発見された場合に、その
    情報とともに、利用モジュールに通知する。
  
* 通信可能なDenebが、明確に通信出来ないくなったことが分かった場合、呼び出し元に通知する。
  - mDNSの場合の例として、例えば "goodbye" announcement(RFC6762 10.1)
    を受信できた場合に、呼び出し元に通知する。
  
* 呼び出しに応じて、Denebと通信できる状態かを確認し返答する。
  - 通信確認のための、Web API(GET /ping)を叩いて、通信できる状態にあるか確認する。

* 対象デバイスからデバイス側定義の追加情報を取得する。
  - 追加情報の検出は、デバイスの検出そのものとは独立して行われ、追加情
    報の取得に失敗した場合でも、デバイスの検出は成功したものと見なす。

Module Network Communication
--------------------

* このModuleおよび、利用しているModuleは、TCP/IPの同一セグメント上から、
  対応デバイスを検出するために、mDNSを利用する。
  - ただし、USB-Ethernetインターフェースが発見された際は、IpV6アドレスを生成し、mDNS応答前にデバイス一覧に登録する。

* 対応デバイスのIdentityを特定するために、
  HTTP GET /register/serial_number を利用する。
  このAPIの戻り値のJSON: { value: "..." } の "..." を deviceId として、
  呼び出しもとに返答する。
  このAPIが存在しない、もしくは応答しない場合には、デバイスは検出しない。

* 対応デバイスの追加情報を取得するために、
  HTTP GET /register/information を利用する。
  ただし、このAPIが存在しない場合、正常応答しない場合でも、デバイスは
  検出できたものとする。また、このModuleでは、戻り値のJSONの内容を一切
  解釈しない。
  
Module API
--------------------

* [Interface](doc/interface.md)

Module Main Dependencies
--------------------

* [dependencies](doc/dependencies.md)

Module Install
--------------------

* Windows (use mdns-js module)
- npm run depend-win

* MacOSX (use mdns module)
- npm run depend-mac

* Common (その他共通モジュールの準備)
- npm install

Unit Test
--------------------

* install and run → `npm install; npm run test`
  - もしもテストのリソースだけを入れたい場合は `npm install --only=dev` で。
