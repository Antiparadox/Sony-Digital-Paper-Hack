//
//  MacErrorCode.h
//
//  Copyright 2016 Sony Corporation
//

#pragma once

#include <CoreFoundation/CoreFoundation.h>
#include "AutoCfRef.h"
#include "StringUtils.h"

#include <iostream>
#include <sstream>
#include <unistd.h>
#include <string>

class MacErrorCode
{
public:
    static std::string ToString(/*[in]*/ CFErrorRef error)
    {
        AutoCfRef<CFStringRef> message = CFErrorCopyDescription(error);
        std::string errMsg = StringUtils::CFStringToStlString(message, kCFStringEncodingUTF8);
        CFIndex errCode = CFErrorGetCode(error);
        return "MAC:" + std::to_string(errCode) + ":" + errMsg;
    }

    static std::string ToString(/*[in]*/ OSStatus error)
    {
        AutoCfRef<CFStringRef> message = SecCopyErrorMessageString(error, nullptr);;
        std::string errMsg = StringUtils::CFStringToStlString(message, kCFStringEncodingUTF8);
        return "MAC:" + std::to_string(error) + ":" + errMsg;
    }

	static std::string GetLastError()
	{
        const int error = errno;
        const static size_t buffer_size = 1024;
        char buffer[buffer_size + 1] = {0};
        const char* message = (strerror_r(error, buffer, buffer_size) == 0) ? buffer : nullptr;
        return "MAC:" + std::to_string(error) + ":" + message;
	}
};

