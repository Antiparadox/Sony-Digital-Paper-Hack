# node-usb-ethernet-finder-mw

Win/MacにUSB接続されたNetwork Adapterを検索し、USB機器の情報およびNetwork Interfaceの情報を取得する。

### [Changelog](https://github.com/LinfinyJapan/dps_node-usb-ethernet-finder-mw/blob/master/CHANGELOG.md)


# Install
```
> cd node-usb-ethernet-finder-mw
> npm install
```

### Common:

  - Python 2.x
  - [node-gyp](https://github.com/TooTallNate/node-gyp)

### Windows:

  - Visual Studio 2013
  - [Windows 8.1 SDK](http://msdn.microsoft.com/ja-jp/windows/desktop/bg162891)
    - "cfgmgr32.lib" を必要とするため

### Mac OS X:

 - xCode Command Line Tools
  - [Downloads for Apple Developers](https://developer.apple.com/downloads/) からダウンロード可能


# Usage

```js
var UsbEthernetFinder = require('node-usb-ethernet-finder-mw');

// Win/Macに現在USB接続されているVID:0x054C,PID:0x0BDDのNICを検索する
UsbEthernetFinder.find(0x054C, 0x0BDD, function(err, result) {
    if (!err) {
        console.log(result);
    }
});

/* Console output:
[ { "deviceId":"USB\\VID_054C&PID_0BDD\\012345678900001",
    "vendorId":1356,
    "productId":3037,
    "vendorName":"(標準 USB ホスト コントローラー)",
    "deviceName":"USB Composite Device",
    "serialNumber":"012345678900001",
    "adapterName":"Digital Paper network port #10",
    "ipInfoArray":[ { "address":"fe80::4133:b287:492b:3ec7",
                      "netmask":"ffff:ffff:ffff:ffff::",
                      "family":"IPv6",
                      "mac":"02:35:37:35:3b:3c",
                      "scopeid":32,
                      "internal":false },
                    {
                      "address":"169.254.62.199",
                      "netmask":"255.255.0.0",
                      "family":"IPv4",
                      "mac":"02:35:37:35:3b:3c",
                      "internal":false
                    } ] } ]
＊・
```


# API

## `find(vid, pid, callback)`
 - 現在、Win/MacにUSB接続されているNICを検索する。


-----

# Debug

`node-usb-ethernet-finder-mw`自身のdebugに関する情報。

### Setup

1. 事前準備
  1. `node-gyp`のインストール
  ```
  $ npm install -g node-gyp
  ```
2. Xcode project file の生成
  1. `npm install`で通常のセットアップ(./build/Makefileの作成とビルド)
  2. `npm configure -- -f xcode`でXcodeのprojectファイル(./build/binding.xcodeproj)を生成
  ```
  $ cd node-usb-ethernet-finder-mw
  $ npm install
    ...
  $ node-gyp configure -- -f xcode
    ...
  $ open build/binding.xcodeproj
  ```
3. Xcodeの設定変更
  1. Xcodeのprojectファイル(./build/binding.xcodeproj)を開く
  2. Xcodeのメニューを` Product > Scheme > Edit Scheme `と選択する
  3. Xcodeのダイアログ上で` Run > info > Executable > Other... `と選択する
  4. terminal 上で`which node`を実行し、node.jsのインストールパスをコピーする
  ```
  $ which node
  /usr/local/bin/node
  ```
  5. Xcode上でキーボードから`Command + Shift + G`を入力する
  6. "Go to the folder:"にnode.jsのインストールパスを貼り付ける
  7. Xcodeのダイアログ上で` Run > Arguments `と選択する
  8. Xcodeのダイアログ上で`Arguments Passed On Launch`の＋を押す
  9. 実行対象のjsファイルの絶対パスを入力し、Closeを押す
  10. Xcodeの左ペインの`binding`を選択する
  11. Xcode上で` TRAGETS > usb_ethernet_finder > Build Phases `と選択する
  12. `Link Binary With Libraries`の＋を押し、以下を追加する
    - CoreFoundation.framework
    - IOKit.framework

- 参考情報
  - I/O Registry Explorer
    - https://developer.apple.com/downloads から"Hardware IO Tools for Xcode" をダウンロードする
  - Apple Open Source
    - [iodisplayregistry.c](http://opensource.apple.com//source/IOKitUser/IOKitUser-755.42.1/iodisplayregistry.c)
    - [USBNotificationExample.c](http://opensource.apple.com//source/IOUSBFamily/IOUSBFamily-206.4.1/Examples/Another%20USB%20Notification%20Example/USBNotificationExample.c)
