//
//  usb_ethernet_finder.cc
//
//  Copyright 2016 Sony Corporation
//

#include <nan.h>
#include <node.h>

#include "FindUsbEthernetWorker.h"

/**
 * Macに接続されているUSB(Ethernet)機器を検索する。
 *
 * @param idVendor	検索対象のUSB機器のVID
 * @param idProduct	検索対象のUSB機器のPID
 * @param callback	検索処理が完了した際のcallback
 */
NAN_METHOD(find)
{
    Nan::HandleScope();
    
    // check the number of function arguments
    if (info.Length() != 3) {
        Nan::ThrowTypeError("Number of arguments must be 3.");
        return;
    }
    
    // check the types of function arguments
    if (!info[0]->IsInt32()) {
        Nan::ThrowTypeError("1st argument (idVendor) must be Int32.");
        return;
    }
    if (!info[1]->IsInt32()) {
        Nan::ThrowTypeError("2nd argument (idProduct) must be Int32.");
        return;
    }
    if (!info[2]->IsFunction()) {
        Nan::ThrowTypeError("3rd argument (callback) must be Function.");
        return;
    }
    
    int idVendor = info[0]->Int32Value();
    int idProduct = info[1]->Int32Value();
    auto callback = new Nan::Callback(info[2].As<v8::Function>());
    
    // start a background task
    Nan::AsyncQueueWorker(new FindUsbEthernetWorker(idVendor, idProduct, callback));
}

NAN_MODULE_INIT(init)
{
    NAN_EXPORT(target, find);
}

NODE_MODULE(usb_ethernet_finder, init);
