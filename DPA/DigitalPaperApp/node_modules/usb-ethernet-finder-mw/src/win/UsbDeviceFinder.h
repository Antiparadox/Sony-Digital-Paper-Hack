//
//  UsbDeviceFinder class　
//
//  Windowsに接続されているUSB機器を検出するクラス。
//
//  Copyright 2016 Sony Corporation
//

#pragma once

#include "UsbDevice.h"
#include "tstring.h"
#include "AutoBinaryPtr.h"

#include <windows.h>
#include <cfgmgr32.h>
#include <vector>
#include <memory>


class UsbDeviceFinder
{
public:
	static std::string FindUsbDevices(
		/*[in]*/ const UINT16 idVendor,
		/*[in]*/ const UINT16 idProduct,
		/*[out]*/ std::vector<std::shared_ptr<UsbDevice>>& rvDeviceList
		);

	static std::string FindUsbDevices(
		/*[in]*/ tstring& rsPnpDeviceId,
		/*[out]*/ std::vector<std::shared_ptr<UsbDevice>>& rvDeviceList
		);

	static std::string EnumUsbDevices(
		/*[out]*/ std::vector<std::shared_ptr<UsbDevice>>& rvDeviceList
		);

	static void ExtractVidPidSerial(
		/*[in]*/ const tstring& rsPnpDeviceId,
		/*[out]*/ UINT16& idVendor,
		/*[out]*/ UINT16& idProduct,
		/*[out]*/ tstring* psSerialNumber
		);

private :
	UsbDeviceFinder(){};

	static void FindUsbDevices(
		/*[in]*/ const tstring& rTargetDevice,
		/*[in]*/ const DEVINST ulDevInst,
		/*[in]*/ std::shared_ptr<UsbDevice> spParentDevice,
		/*[out]*/ std::vector<std::shared_ptr<UsbDevice>>& rvDeviceList
		);

	static void GetDeviceInfo(
		/*[in]*/ const DEVINST ulDevInst,
		/*[in,out]*/ std::shared_ptr<UsbDevice>& spDevice
		);

	static std::string GetDeviceProperty(
		/*[in]*/ const DEVINST ulDevInfoSet,
		/*[in]*/ const ULONG ulPropertyId,
		/*[out]*/ tstring& rvProperty
		);

	static std::string GetDeviceProperties(
		/*[in]*/ const DEVINST ulDevInfoSet,
		/*[in]*/ const ULONG ulPropertyId,
		/*[out]*/ std::vector<tstring>& rvProperties
		);

	static std::vector<tstring> GetPropertyStrings(
		/*[in]*/ const ULONG ulRegType,
		/*[in]*/ const ULONG ulDataSize,
		/*[in]*/ const AutoBinaryPtr& rspData
		);

};
