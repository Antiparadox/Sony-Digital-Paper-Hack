//
//  WmDeviceChangeHandler.h
//
//  Windowsへのデバイス追加・削除のイベント(WM_DEVICECHANGE)をハンドリングするクラス。
// 
//  Copyright 2016 Sony Corporation
//

#pragma once

#include <uv.h>
#include <string>

extern"C" {
	typedef void(__stdcall *OnStart)(/*[in]*/ std::string errMsg);
	typedef void(__stdcall *OnStop)(/*[in]*/ std::string errMsg);
	typedef void(__stdcall *OnWmDeviceChange)(/*[in]*/ WPARAM wParam, /*[in]*/ LPARAM lParam);
}

class WmDeviceChangeHandler
{
public:
	WmDeviceChangeHandler();
	~WmDeviceChangeHandler();

	std::string Start(
		/*[in]*/ OnStart pOnStartCallback,
		/*[in]*/ OnWmDeviceChange pCallback
		);

	std::string Stop(
		/*[in]*/ OnStop pOnStopCallback
		);

private:
	static UINT __stdcall StartMessageThread(void* pval);
	
	UINT MessageThread();

	static LRESULT CALLBACK WindowProc(
		/*[in]*/ HWND hwnd,
		/*[in]*/ UINT uMsg,
		/*[in]*/ WPARAM wParam,
		/*[in]*/ LPARAM lParam
		);
	
	static void OnDeviceChange(
		/*[in]*/ WPARAM wParam,
		/*[in]*/ LPARAM lParam
		);

	HANDLE hMsgThread;
	UINT32 uMsgThreadId;
	HDEVNOTIFY hDevNotify;
};

