# node-usb-detector-mw

Win/Mac へのUSB機器の接続/切断を検出する。

### [Changelog](https://github.com/LinfinyJapan/dps_node-mw-usb-detector/blob/master/CHANGELOG.md)


# Install

 1. GitHub上の [node-usb-detector-mw](https://github.com/LinfinyJapan/dps_node-usb-detector-mw.git) をローカルにクローンする
 2. 'npm install' を使用して`node-usb-detector-mw`をインストールする
```
> cd node-usb-detector-mw
> npm install
```

### Common:

  - Python 2.x
  - [node-gyp](https://github.com/TooTallNate/node-gyp)

### Windows:

  - Visual Studio 2013
  - [Windows 8.1 SDK](http://msdn.microsoft.com/ja-jp/windows/desktop/bg162891)
    - "cfgmgr32.lib" を必要とするため

### Mac OS X:

 - xCode Command Line Tools
  - [Downloads for Apple Developers](https://developer.apple.com/downloads/) からダウンロード可能


# Usage

```js
var UsbDetector = require('usb-detector-mw');
const detector = new UsbDetector();

// USB機器の接続通知
detector.on('add:' + 0x054C, function (device) {
  console.log('onAdded', device);
});

// USB機器の切断通知
detector.on('remove:' + 0x054C, function (device) {
  console.log('onRemoved', device);
});

// USBの接続/切断の検出処理を開始する
detector.start(function (error, deviceArray) {
  if (error) {
    console.log('start', error);
    return;
  }
  console.log('start', deviceArray);
});

// USB機器を検索する
detector.find(0x054C, function (error, deviceArray) {
  if (error) {
    console.log('find', error);
    return;
  }
  console.log('find', deviceArray);
});

// USBの接続/切断の検出処理を終了する
detector.stop(function (error) {
  if (error) {
    console.log('stop', error);
    return;
  }
  console.log('stop');
});
```


# API

## `start(vid, pid, callback)`
 - Win/MacへのUSB機器の接続/切断の検出処理を開始/再開する。
 - 検出処理の開始時に、接続されているUSB機器の一覧をcallbackする。

### 使用方法
  - API:
    - `start()`
    - `start(callback)`
    - `start(vid, callback)`
    - `start(vid, pid, callback)`
  - Paramters:
    - `vid`: 検出開始時に接続されいるUSB機器の中で、結果に含めるUSB機器の`Vendor ID`
    - `pid`: 検出開始時に接続されいるUSB機器の中で、結果に含めるUSB機器の`Product ID`
    - `callback`: 検出処理が開始された際に呼び出される`callback`

### 使用例
```js
var UsbDetector = require('usb-detector-mw');
const detector = new UsbDetector();

detector.start(0x054C, function (error, deviceArray) {
  if (error) {
    console.log('start', error);
    return;
  }
  console.log('start', deviceArray);
});

/* Console output:
start [ { deviceId: 'USB\\VID_054C&PID_0BE5\\012345678900002',
    vendorId: 1356,
    productId: 3045,
    vendorName: '(標準 USB ホスト コントローラー)',
    deviceName: 'USB Composite Device',
    serialNumber: '012345678900002' },
  { deviceId: 'USB\\VID_054C&PID_0BE5\\012345678900001',
    vendorId: 1356,
    productId: 3045,
    vendorName: '(標準 USB ホスト コントローラー)',
    deviceName: 'USB Composite Device',
    serialNumber: '012345678900001' } ]
*/
```

## `stop(callback)`
 - Win/MacへのUSB機器の接続/切断の検出処理を中断/終了する。

### 使用方法
  - API:
    - `stop()`
    - `stop(callback)`
  - Paramters:
    - `callback`: 検出処理が終了した際に呼び出される`callback`


## `on(eventName, callback)`

 - `eventName`: 検出するイベントの指定
 	 - `add`: USB接続時のイベント
 	 	 - `add:vid`
 	 	 - `add:vid:pid`
 	 - `remove`: USB切断時のイベント
 	 	 - `remove:vid`
 	 	 - `remove:vid:pid`
 - `callback`: 指定されたイベントが検出された際に呼び出されるcallback

```js
var UsbDetector = require('usb-detector-mw');
const detector = new UsbDetector();

detector.on('add:' + 0x054C, function (device) {
  console.log('onAdded', device);
});

detector.on('remove:' + 0x054C, function (device) {
  console.log('onRemoved', device);
});

detector.start(0x054C, function (deviceArray) {
  console.log('start', deviceArray);
});

/* Console output:
onAdded { deviceId: 'USB\\VID_054C&PID_0BE5\\012345678900001',
  vendorId: 1356,
  productId: 3045,
  vendorName: '(標準 USB ホスト コントローラー)',
  deviceName: 'USB Composite Device',
  serialNumber: '012345678900001' }
onRemoved { deviceId: 'USB\\VID_054C&PID_0BE5\\012345678900001',
  vendorId: 1356,
  productId: 3045,
  vendorName: '(標準 USB ホスト コントローラー)',
  deviceName: 'USB Composite Device',
  serialNumber: '012345678900001' }
*/
```

## `find(vid, pid, callback)`
 - 現在、Win/Macに接続されているUSB機器を検索する。
 - `start(vid, pid, callback)`の`callback`が呼び出された以降に呼び出す必要がある。

### 使用方法
  - API:
    - `find()`
    - `find(callback)`
    - `find(vid, callback)`
    - `find(vid, pid, callback)`
  - Paramters:
    - `vid`: 検索対象のUSB機器の`Vendor ID`
    - `pid`: 検索対象のUSB機器の`Product ID`
    - `callback`: 検索が完了した際に呼び出される`callback`

### 使用例
```js
var UsbDetector = require('usb-detector-mw');
const detector = new UsbDetector();

detector.start(function (error, deviceArray) {
  if (error) {
    console.log('start', error);
    return;
  }
  
  detector.find(0x054C, function(error, deviceArray) {
    if (error) {
      console.log('find', error);
      return;
    }
    console.log('find', deviceArray);
  });
});

/* Console output:
find [ { deviceId: 'USB\\VID_054C&PID_0BE5\\012345678900002',
    vendorId: 1356,
    productId: 3045,
    vendorName: '(標準 USB ホスト コントローラー)',
    deviceName: 'USB Composite Device',
    serialNumber: '012345678900002' },
  { deviceId: 'USB\\VID_054C&PID_0BE5\\012345678900001',
    vendorId: 1356,
    productId: 3045,
    vendorName: '(標準 USB ホスト コントローラー)',
    deviceName: 'USB Composite Device',
    serialNumber: '012345678900001' } ]
*/
```

