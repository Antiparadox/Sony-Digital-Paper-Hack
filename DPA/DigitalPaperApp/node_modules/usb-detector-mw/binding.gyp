{
  "targets": [
    {
      "target_name": "usb_detector",
      "sources": [
        "src/usb_detector.cc",
        "src/StartDetectionWorker.h",
        "src/WaitDetectionWorker.h",
        "src/StopDetectionWorker.h",
        "src/FindDeviceWorker.h",
        "src/UsbDetectObserver.h",
        "src/UsbDevice.h",
        "src/UsbDetectManager.h",
        "src/DeviceEvent.h",
        "src/Event.h",
        "src/Log.h",
        "src/tstring.h",
      ],
      "include_dirs": [
        "<!(node -e \"require('nan')\")"
      ],
      'conditions': [
        ['OS=="win"',
          {
            'sources': [
              "src/win/AutoCriticalSection.h",
              "src/win/AutoBinaryPtr.h",
              "src/win/CmApiWrap.cpp",
              "src/win/CmApiWrap.h",
              "src/win/CriticalSection.h",
              "src/win/Event.cpp",
              "src/win/Log.cpp",
              "src/win/macro.h",
              "src/win/Utility.h",
              "src/win/UsbDetector.cpp",
              "src/win/UsbDetector.h",
              "src/win/UsbDeviceFinder.cpp",
              "src/win/UsbDeviceFinder.h",
              "src/win/usbiodef.h",
              "src/win/WinErrorCode.h",
              "src/win/WmDeviceChangeHandler.cpp",
              "src/win/WmDeviceChangeHandler.h",
            ],
            'include_dirs+': 
            [
              # Not needed now
            ],
            "libraries": [
              "cfgmgr32.lib"
            ],
            'msvs_settings': {
              'VCCLCompilerTool': {
                'PreprocessorDefinitions': [
                  '_WIN32_WINNT=0x0601',	# Windows 7 or later
                ],
                'ExceptionHandling': '1', # /EHsc
                'TreatWChar_tAsBuiltInType': 'true',   # /Zc:wchar_t
              }
            },
            'msvs_configuration_attributes': {
              'CharacterSet': '1', # Use Unicode Character Set
            },
          }
        ],
        ['OS=="mac"',
          {
            'sources': [
              "src/mac/Event.cpp",
              "src/mac/Log.cpp",
              "src/mac/MacErrorCode.h",
              "src/mac/AutoCFString.h",
              "src/mac/UsbDetector.h",
              "src/mac/UsbDetector.cpp",
            ],
            "libraries": [
              "-framework",   
              "IOKit"
            ],
            'xcode_settings': {
              'MACOSX_DEPLOYMENT_TARGET': '10.10',
              'GCC_ENABLE_CPP_RTTI': 'YES',
              'GCC_ENABLE_CPP_EXCEPTIONS': 'YES',
              'CLANG_CXX_LANGUAGE_STANDARD':'c++11',
              'OTHER_CPLUSPLUSFLAGS' : ['-stdlib=libc++'],
              'OTHER_LDFLAGS': ['-stdlib=libc++'],
            },
          }
        ],
      ]
     }
   ]
 }