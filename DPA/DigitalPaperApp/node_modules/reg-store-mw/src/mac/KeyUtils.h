//
//  KeyUtils.h
//
//  Copyright 2016 Sony Corporation
//

#pragma once

#include <CoreFoundation/CoreFoundation.h>
#include <Security/Security.h>
#include <string>


class KeyUtils
{
public:
    /**
     * RSA 2048 bit で秘密鍵・公開鍵を生成し、PEM形式でファイルに出力する。
     *
     * @param privateKeyPath 秘密鍵の保存先ファイルパス
     * @param publicKeyPath 公開鍵の保存先ファイルパス
     * @return 成功時には空のstringオブジェクトを、失敗時にはエラーメッセージを
     *      含むstringオブジェクトを返却する。
     */
    static std::string GenRsa2048KeyPair(
		/*[in]*/ const std::string& privateKeyPath,
		/*[in]*/ const std::string& publicKeyPath
		);

    
private:
    static std::string exportKeyFromKeyChain(
        /*[in]*/ SecKeyRef keyRef,
        /*[out]*/ CFDataRef* keyData
        );
    
    static std::string deleteKeyFromKeyChain(
        /*[in]*/ SecKeyRef keyRef
        );
    
    static std::string writeKeyFile(
        /*[in]*/ const std::string& filePath,
        /*[in]*/ CFDataRef pemKeyData
        );

    static char* getCString(
        /*[in]*/ CFStringRef srcString
        );
};

