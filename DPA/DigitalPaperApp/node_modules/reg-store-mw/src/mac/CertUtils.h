//
//  CertUtils.h
//
//  Copyright 2016 Sony Corporation
//

#pragma once

#include <CoreFoundation/CoreFoundation.h>
#include <Security/Security.h>
#include <string>



class CertUtils
{
public:

	/**
	 * PEM形式の証明書をキーチェーンの「ログイン」に登録し、登録された証明書の
     * 「SSL (Secure Sockets Layer)」を「常に信頼」 に設定する。
	 * 
	 * @param pemFormattedCert PEM形式の証明書
	 * @return 成功時には空のstringオブジェクトを、失敗時にはエラーメッセージを
     *      含むstringオブジェクトを返却する。
	 */
	static std::string addCertToRootStore(
		/*[in]*/ const std::string& pemFormattedCert
		);

    
private:
    
    static std::string decodeBase64String(
		/*[in]*/ CFStringRef base64String,
        /*[out]*/ CFDataRef* decodedData
        );

    static std::string createCertQueryCondition(
        /*[in]*/ SecCertificateRef originalCert,
        /*[in]*/ SecKeychainRef targetKeychain,
        /*[out]*/ CFDictionaryRef* query
        );
};

