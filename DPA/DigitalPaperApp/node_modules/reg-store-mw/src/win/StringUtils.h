//
//  StringUtils.h
//
//  Copyright 2016 Sony Corporation
//

#pragma once

#include <windows.h>
#include <string>
#include <vector>


class StringUtils
{
public:
    
    static ULONG Utf8ToUtf16(
		/*[in]*/ const std::string& utf8string,
		/*[out]*/ std::wstring& utf16string
		) {

		ULONG result = ERROR_SUCCESS;

		// UTF-16 に変換後のサイズを求める
		const int wstrLength = ::MultiByteToWideChar(
			/* UINT CodePage			*/	CP_UTF8,
			/* DWORD dwFlags			*/	0,
			/* LPCSTR lpMultiByteStr	*/	utf8string.c_str(),
			/* int cchMultiByte			*/	-1,
			/* LPWSTR lpWideCharStr     */	NULL,
			/* int cchWideChar			*/	0
			);

		// UTF-16 文字列用のバッファを用意する
		std::vector<WCHAR> outBuffer(wstrLength);

		// UTF-16 に変換する
		const int writtenSize = ::MultiByteToWideChar(
			/* UINT CodePage			*/	CP_UTF8,
			/* DWORD dwFlags			*/	0,
			/* LPCSTR lpMultiByteStr	*/	utf8string.c_str(),
			/* int cchMultiByte			*/	-1,
			/* LPWSTR lpWideCharStr     */	reinterpret_cast<WCHAR*>(&outBuffer[0]),
			/* int cchWideChar			*/	wstrLength
			);
		if (writtenSize == 0) {
			return ::GetLastError();
		}

		// std::wstring に格納する
		utf16string = std::wstring(&outBuffer[0], wstrLength);

		return ERROR_SUCCESS;
    }
};
