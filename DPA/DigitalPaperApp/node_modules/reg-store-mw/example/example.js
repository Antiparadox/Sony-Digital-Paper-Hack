process.env.DEBUG = "reg-store-mw:reg-store:error, reg-store-mw:crypto_utils:error";

'use strict';

const fs = require('fs');
var regStore = require('../index.js');

// 環境変数 MW_USER_DATA_DIR_PATH の設定
const MW_PATH_PREFIX = '/Sony Corporation/Digital Paper App';
let appDataPath;
if (process.platform === 'win32') {
  appDataPath = process.env.APPDATA;
} else {
  appDataPath = process.env.HOME + '/Library';
}
process.env.MW_USER_DATA_DIR_PATH = appDataPath + MW_PATH_PREFIX;

// アプリデータ保存用ディレクトリの作成
try {
    var userDataDirStat = fs.statSync(process.env.MW_USER_DATA_DIR_PATH);
} catch (e) {
    if ( e.code === 'ENOENT' ) {
        fs.mkdirSync(process.env.MW_USER_DATA_DIR_PATH);
    }
}

regStore.getClientDeviceId(function (error, deviceId) {
  if (error) {
    console.error(error);
    return;
  }
  console.log("deviceId: " + deviceId);
});


fs.readFile('./example/deneb.crt', function (error, data) {
  if (error) {
    console.error(error);
    return;
  }
  regStore.addServerCert(data.toString(), function (error) {
    if (error) {
      console.error(error);
      return;
    }
    console.log("regStore.addServerCert() succeeded.");
  });
});


regStore.getClientPrivateKey(function (error, privKey) {
  if (error) {
    console.error(error);
    return;
  }
  console.log(privKey);

  regStore.getClientPublicKey(function (error, pubKey) {
    if (error) {
      console.error(error);
      return;
    }
    console.log(pubKey);
  });
});